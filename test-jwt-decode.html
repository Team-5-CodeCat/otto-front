<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JWT í† í° ë””ì½”ë”© í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .result {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .error {
        background: #ffebee;
        color: #c62828;
      }
      .success {
        background: #e8f5e8;
        color: #2e7d32;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      input,
      textarea {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” JWT í† í° ë””ì½”ë”© í…ŒìŠ¤íŠ¸</h1>

      <div class="test-section">
        <h2>1. JWT í† í° ë””ì½”ë”© í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
        <p>JWT í† í°ì„ ì…ë ¥í•˜ë©´ ë””ì½”ë”©ëœ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

        <textarea id="jwtInput" placeholder="JWT í† í°ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..." rows="3"></textarea>
        <br />
        <button onclick="decodeJWT()">í† í° ë””ì½”ë”©</button>
        <button onclick="generateTestToken()">í…ŒìŠ¤íŠ¸ í† í° ìƒì„±</button>

        <div id="decodeResult" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>2. ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ í…ŒìŠ¤íŠ¸</h2>
        <p>JWT í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´(userID, email)ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>

        <button onclick="extractUserInfo()">ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ</button>

        <div id="userInfoResult" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>3. í† í° ë§Œë£Œ í™•ì¸ í…ŒìŠ¤íŠ¸</h2>
        <p>JWT í† í°ì˜ ë§Œë£Œ ì‹œê°„ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>

        <button onclick="checkTokenExpiry()">ë§Œë£Œ ì‹œê°„ í™•ì¸</button>

        <div id="expiryResult" class="result" style="display: none"></div>
      </div>
    </div>

    <script>
      // JWT í† í° ë””ì½”ë”© í•¨ìˆ˜ (í”„ë¡ íŠ¸ì—”ë“œì™€ ë™ì¼)
      function decodeJWT(token) {
        try {
          const base64Url = token.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const jsonPayload = decodeURIComponent(
            atob(base64)
              .split('')
              .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
              .join('')
          );
          return JSON.parse(jsonPayload);
        } catch (error) {
          console.error('JWT ë””ì½”ë”© ì‹¤íŒ¨:', error);
          return null;
        }
      }

      // ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ í•¨ìˆ˜
      function getUserFromToken(token) {
        const payload = decodeJWT(token);
        if (payload && payload.type === 'access') {
          return {
            userID: payload.sub,
            email: payload.email,
          };
        }
        return null;
      }

      // í† í° ë§Œë£Œ í™•ì¸ í•¨ìˆ˜
      function isTokenExpired(token) {
        const payload = decodeJWT(token);
        if (!payload || !payload.exp) {
          return true;
        }
        const currentTime = Date.now() / 1000;
        return payload.exp < currentTime;
      }

      // í† í° ë””ì½”ë”© í…ŒìŠ¤íŠ¸
      function decodeJWT() {
        const token = document.getElementById('jwtInput').value.trim();
        const resultDiv = document.getElementById('decodeResult');

        if (!token) {
          resultDiv.innerHTML = '<div class="error">JWT í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
          resultDiv.style.display = 'block';
          return;
        }

        const decoded = decodeJWT(token);
        if (decoded) {
          resultDiv.innerHTML = `
                    <div class="success">âœ… JWT ë””ì½”ë”© ì„±ê³µ!</div>
                    <pre>${JSON.stringify(decoded, null, 2)}</pre>
                `;
        } else {
          resultDiv.innerHTML =
            '<div class="error">âŒ JWT ë””ì½”ë”© ì‹¤íŒ¨! ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤.</div>';
        }
        resultDiv.style.display = 'block';
      }

      // ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ í…ŒìŠ¤íŠ¸
      function extractUserInfo() {
        const token = document.getElementById('jwtInput').value.trim();
        const resultDiv = document.getElementById('userInfoResult');

        if (!token) {
          resultDiv.innerHTML = '<div class="error">JWT í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
          resultDiv.style.display = 'block';
          return;
        }

        const userInfo = getUserFromToken(token);
        if (userInfo) {
          resultDiv.innerHTML = `
                    <div class="success">âœ… ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ì„±ê³µ!</div>
                    <div><strong>User ID:</strong> ${userInfo.userID}</div>
                    <div><strong>Email:</strong> ${userInfo.email}</div>
                    <div><strong>Name:</strong> ${userInfo.email.split('@')[0] || 'ì‚¬ìš©ì'}</div>
                `;
        } else {
          resultDiv.innerHTML =
            '<div class="error">âŒ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ì‹¤íŒ¨! Access Tokenì´ ì•„ë‹ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>';
        }
        resultDiv.style.display = 'block';
      }

      // í† í° ë§Œë£Œ í™•ì¸ í…ŒìŠ¤íŠ¸
      function checkTokenExpiry() {
        const token = document.getElementById('jwtInput').value.trim();
        const resultDiv = document.getElementById('expiryResult');

        if (!token) {
          resultDiv.innerHTML = '<div class="error">JWT í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
          resultDiv.style.display = 'block';
          return;
        }

        const payload = decodeJWT(token);
        if (!payload) {
          resultDiv.innerHTML = '<div class="error">âŒ JWT ë””ì½”ë”© ì‹¤íŒ¨!</div>';
          resultDiv.style.display = 'block';
          return;
        }

        const isExpired = isTokenExpired(token);
        const currentTime = new Date();
        const expiryTime = new Date(payload.exp * 1000);
        const timeLeft = expiryTime - currentTime;

        resultDiv.innerHTML = `
                <div class="${isExpired ? 'error' : 'success'}">
                    ${isExpired ? 'âŒ í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' : 'âœ… í† í°ì´ ìœ íš¨í•©ë‹ˆë‹¤!'}
                </div>
                <div><strong>ë°œê¸‰ ì‹œê°„:</strong> ${new Date(payload.iat * 1000).toLocaleString()}</div>
                <div><strong>ë§Œë£Œ ì‹œê°„:</strong> ${expiryTime.toLocaleString()}</div>
                <div><strong>í˜„ì¬ ì‹œê°„:</strong> ${currentTime.toLocaleString()}</div>
                <div><strong>ë‚¨ì€ ì‹œê°„:</strong> ${isExpired ? 'ë§Œë£Œë¨' : Math.floor(timeLeft / 1000 / 60) + 'ë¶„ ' + Math.floor((timeLeft % 60000) / 1000) + 'ì´ˆ'}</div>
            `;
        resultDiv.style.display = 'block';
      }

      // í…ŒìŠ¤íŠ¸ìš© JWT í† í° ìƒì„± (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì—ì„œ ìƒì„±)
      function generateTestToken() {
        const testPayload = {
          sub: 'test-user-123',
          email: 'test@example.com',
          type: 'access',
          exp: Math.floor(Date.now() / 1000) + 15 * 60, // 15ë¶„ í›„ ë§Œë£Œ
          iat: Math.floor(Date.now() / 1000),
        };

        // ì‹¤ì œ JWTëŠ” ì„œëª…ì´ í•„ìš”í•˜ì§€ë§Œ, í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ê°„ë‹¨íˆ ìƒì„±
        const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
        const payload = btoa(JSON.stringify(testPayload));
        const signature = 'test-signature'; // ì‹¤ì œë¡œëŠ” HMAC ì„œëª…ì´ í•„ìš”

        const testToken = `${header}.${payload}.${signature}`;
        document.getElementById('jwtInput').value = testToken;

        document.getElementById('decodeResult').innerHTML = `
                <div class="success">âœ… í…ŒìŠ¤íŠ¸ í† í°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                <div><strong>ì£¼ì˜:</strong> ì´ í† í°ì€ í…ŒìŠ¤íŠ¸ìš©ì´ë©° ì‹¤ì œ ì„œëª…ì´ ì—†ì–´ ë°±ì—”ë“œì—ì„œ ê²€ì¦í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
            `;
        document.getElementById('decodeResult').style.display = 'block';
      }
    </script>
  </body>
</html>
